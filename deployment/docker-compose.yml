services:
  web:
    build:
      context: ..
      dockerfile: deployment/Dockerfile.frontend
    container_name: osm_cover_web
    ports:
      - "8080:80"
    volumes:
      # Mount the generated data into a subdirectory that we alias in Nginx
      - generated_data:/usr/share/nginx/html/data_mount:ro
      # Persist Nginx logs to host (in project root logs/)
      - ../logs:/var/log/nginx
    restart: unless-stopped

  worker:
    build:
      context: ..
      dockerfile: deployment/Dockerfile.worker
    container_name: osm_cover_worker
    volumes:
      - ../data:/app/data
      # Worker writes to site/public, which we persist
      - generated_data:/app/site/public
      # Mount scripts for easier dev/updates without rebuild
      - ../scripts:/app/scripts
      # Persist backups (in project root backups/)
      - ../backups:/app/backups
    environment:
      - PYTHONUNBUFFERED=1
    restart: "no"

volumes:
  generated_data:
