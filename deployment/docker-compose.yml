services:
  web:
    build:
      context: ..
      dockerfile: deployment/Dockerfile.frontend
    container_name: osm_cover_web
    ports:
      - "8080:80"
    volumes:
      # Mount the generated data from host folder (for easy access/editing)
      - ../public_data:/usr/share/nginx/html/data_mount:ro
      # Persist Nginx logs to host (in project root logs/)
      - ../logs:/var/log/nginx
    restart: unless-stopped
    environment:
      - TZ=Europe/Berlin

  backend:
    build:
      context: ..
      dockerfile: deployment/Dockerfile.backend
    container_name: osm_cover_backend
    volumes:
      - ../public_data:/data
      - ../logs:/logs
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      - DATA_DIR=/data

  worker:
    build:
      context: ..
      dockerfile: deployment/Dockerfile.worker
    container_name: osm_cover_worker
    volumes:
      - ../data:/app/data
      # Worker writes to site/public, which we persist on host
      - ../public_data:/app/site/public
      # Mount scripts for easier dev/updates without rebuild
      - ../scripts:/app/scripts
      # Persist backups (in project root backups/)
      - ../backups:/app/backups
    environment:
      - PYTHONUNBUFFERED=1
    restart: "no"
